name: fraud-batch-inference-pipeline

on:
  workflow_dispatch:
#  schedule:
#    - cron: '11 11 * * *'

jobs:
  test_schedule:
    name: Setup ${{ matrix.python }} ${{ matrix.os }} (noenv)
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [macos-latest, windows-latest, ubuntu-18.04, ubuntu-20.04]
        python: ["3.7", "3.8", "3.9", "3.10"]
    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: setup-python ${{ matrix.python }}
      id: setup-python
      uses: ./
      with:
        python-version: ${{ matrix.python }}
        update-environment: false

    - name: Python version
      run: ${{ steps.setup-python.outputs.python-path }} --version

    - name: Run simple code
      run: ${{ steps.setup-python.outputs.python-path }} -c 'import math; print(math.factorial(5))'
    - name: install python packages
      run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          
    - name: install python packages
      run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt 
     
          
    - name: execute python workflows from bash script
      env: 
        HOPSWORKS_API_KEY: ${{ secrets.HOPSWORKS_API_KEY }}
      run: ./src/03-module/scripts/run-fraud-batch-inference.sh

